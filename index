<!DOCTYPE html>
<html lang="es">

<head>
<link rel="manifest" href="manifest.json">

<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<meta name="apple-mobile-web-app-title" content="EMOM Kettlebell">

<link rel="apple-touch-icon" href="icons/icon-192.png">
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Kettlebell EMOM 30</title>

<style>
<script>
if ("serviceWorker" in navigator) {
    navigator.serviceWorker.register("sw.js");
}
</script>
body {
    margin: 0;
    background: #111;
    color: #fff;
    font-family: -apple-system, BlinkMacSystemFont, sans-serif;
}

.container {
    max-width: 420px;
    margin: auto;
    padding: 20px;
    text-align: center;
}

h1 {
    color: #2ed573;
}

/* üîí VIDEO BLOQUEADO (CLAVE) */
video {
    width: 100%;
    max-height: 220px;
    object-fit: cover;
    border-radius: 14px;
    background: black;

    pointer-events: none; /* üö® CLAVE ABSOLUTA */
}

.exercise {
    font-size: 1.5rem;
    margin-top: 10px;
}

.next {
    font-size: 0.9rem;
    opacity: 0.7;
}

.timer {
    font-size: 4rem;
    margin: 10px 0;
}

button {
    padding: 14px 24px;
    border-radius: 30px;
    border: none;
    font-size: 1rem;
    font-weight: bold;
    margin: 5px;
}

.start { background: #2ed573; }
.pause { background: #f1c40f; }
.reset { background: #ff4757; color: white; }
</style>
</head>

<body>

<div class="container">
    <h1>EMOM 30'</h1>

    <video
        id="video"
        playsinline
        webkit-playsinline
        loop
        preload="auto"
        disablePictureInPicture
        controlslist="nodownload nofullscreen noremoteplayback">
    </video>

    <div class="exercise" id="exercise">Preparado</div>
    <div class="next">Siguiente: <span id="next">-</span></div>
    <div class="timer" id="timer">01:00</div>

    <button class="start" onclick="start()">Iniciar</button>
    <button class="pause" onclick="pause()">Pausa</button>
    <button class="reset" onclick="reset()">Reset</button>
</div>

<script>
const exercises = [
    { name: "Russian Swing", file: "russian_swing.mp4" },
    { name: "Alt Bent Rows", file: "alt_bent_rows.mp4" },
    { name: "Goblet Lunges", file: "goblet_lunges.mp4" },
    { name: "Goblet Press", file: "goblet_press.mp4" },
    { name: "Sumo High Pulls", file: "sumo_high_pulls.mp4" },
    { name: "Alt Swings", file: "alt_swings.mp4" },
    { name: "Halos", file: "halos.mp4" },
    { name: "American Swings", file: "american_swings.mp4" },
    { name: "Alt High Pulls", file: "alt_high_pulls.mp4" }
];

const restVideo = "rest.mp4";

let minute = 1;
let seconds = 60;
let interval = null;
let running = false;

const video = document.getElementById("video");
const exerciseEl = document.getElementById("exercise");
const nextEl = document.getElementById("next");
const timerEl = document.getElementById("timer");

function loadMinute() {
    const blockMinute = ((minute - 1) % 10) + 1;

    if (blockMinute === 10) {
        exerciseEl.textContent = "DESCANSO";
        video.src = restVideo;
        nextEl.textContent = exercises[0].name;
    } else {
        const ex = exercises[blockMinute - 1];
        exerciseEl.textContent = ex.name;
        video.src = ex.file;
        nextEl.textContent = blockMinute === 9 ? "DESCANSO" : exercises[blockMinute].name;
    }

    video.muted = false;
    video.currentTime = 0;
    video.play().catch(() => {});
}

function tick() {
    seconds--;
    timerEl.textContent = `00:${seconds < 10 ? "0" : ""}${seconds}`;

    if (seconds <= 0) {
        minute++;
        if (minute > 30) {
            finish();
            return;
        }
        seconds = 60;
        loadMinute();
    }
}

function start() {
    if (running) return;
    running = true;

    loadMinute(); // ‚Üê play SOLO tras click
    interval = setInterval(tick, 1000);
}

function pause() {
    clearInterval(interval);
    running = false;
    video.pause();
}

function reset() {
    pause();
    minute = 1;
    seconds = 60;
    timerEl.textContent = "01:00";
    exerciseEl.textContent = "Preparado";
    nextEl.textContent = "-";
    video.src = "";
}

function finish() {
    clearInterval(interval);
    running = false;
    exerciseEl.textContent = "ENTRENAMIENTO COMPLETADO üí™";
    nextEl.textContent = "";
    timerEl.textContent = "00:00";
    video.pause();
}
</script>

</body>
</html>